<div class="hierarchy-tree-container">
  @if (hasData()) {
    <div class="tree-wrapper">
      <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="hierarchy-tree">
        <!-- Tree node template for nodes with children -->
        <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
          <div class="mat-tree-node">
            <button
              mat-icon-button
              matTreeNodeToggle
              [attr.aria-label]="'Toggle ' + node.topic"
              class="toggle-button">
              <mat-icon class="mat-icon-rtl-mirror">
                {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
              </mat-icon>
            </button>

            <div
              class="node-content"
              [class.selected]="isSelected(node)"
              (click)="onNodeClick(node)">
              <span class="node-topic">{{ node.topic }}</span>

              <div class="node-badges">
                <span
                  class="confidence-badge"
                  [ngClass]="getConfidenceClass(node.confidence)"
                  [attr.aria-label]="'Confidence: ' + formatConfidence(node.confidence)">
                  {{ formatConfidence(node.confidence) }}
                </span>

                <span
                  class="evidence-badge"
                  matBadge="{{ node.evidenceCount }}"
                  matBadgeSize="small"
                  matBadgeColor="accent"
                  [attr.aria-label]="node.evidenceCount + ' pieces of evidence'">
                  <mat-icon class="evidence-icon">verified</mat-icon>
                </span>
              </div>
            </div>
          </div>

          <!-- Children container -->
          @if (treeControl.isExpanded(node)) {
            <div class="children-container" role="group">
              <ng-container matTreeNodeOutlet></ng-container>
            </div>
          }
        </mat-nested-tree-node>

        <!-- Tree node template for leaf nodes -->
        <mat-nested-tree-node *matTreeNodeDef="let node">
          <div class="mat-tree-node">
            <button
              mat-icon-button
              class="toggle-button toggle-placeholder"
              disabled>
            </button>

            <div
              class="node-content"
              [class.selected]="isSelected(node)"
              (click)="onNodeClick(node)">
              <span class="node-topic">{{ node.topic }}</span>

              <div class="node-badges">
                <span
                  class="confidence-badge"
                  [ngClass]="getConfidenceClass(node.confidence)"
                  [attr.aria-label]="'Confidence: ' + formatConfidence(node.confidence)">
                  {{ formatConfidence(node.confidence) }}
                </span>

                <span
                  class="evidence-badge"
                  matBadge="{{ node.evidenceCount }}"
                  matBadgeSize="small"
                  matBadgeColor="accent"
                  [attr.aria-label]="node.evidenceCount + ' pieces of evidence'">
                  <mat-icon class="evidence-icon">verified</mat-icon>
                </span>
              </div>
            </div>
          </div>
        </mat-nested-tree-node>
      </mat-tree>
    </div>
  } @else {
    <div class="empty-state">
      <mat-icon class="empty-icon">account_tree</mat-icon>
      <p class="empty-message">No hierarchy data available</p>
      <p class="empty-hint">Create interests to see their hierarchical relationships</p>
    </div>
  }
</div>
